if (self.CavalryLogger) { CavalryLogger.start_js(["yKuaq"]); }

__d("P2PPlatformContextStore",["Arbiter","ChannelConstants","CurrentUser","EventEmitter","ImmutableObject","MercuryIDs","P2PActionConstants","P2PActions","P2PAPI","P2PChannelType","P2PDispatcher"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=new Map(),i=new Map(),j;c=babelHelpers.inherits(a,b("EventEmitter"));g=c&&c.prototype;function a(){g.constructor.call(this),j=b("P2PDispatcher").register(this.onEventDispatched.bind(this)),b("Arbiter").subscribe(b("ChannelConstants").getArbiterType(b("P2PChannelType").PLATFORM_CONTEXT_NEW),this.handleChannelUpdated.bind(this)),b("Arbiter").subscribe(b("ChannelConstants").getArbiterType(b("P2PChannelType").PLATFORM_CONTEXT_ELIGIBLE_ITEM_UPDATED),this.handleChannelChanged.bind(this)),b("Arbiter").subscribe(b("ChannelConstants").getArbiterType(b("P2PChannelType").PLATFORM_CONTEXT_DISMISSED),this.handleChannelChanged.bind(this))}a.prototype.onEventDispatched=function(a){__p&&__p();var c=a.type;a=a.data;switch(c){case b("P2PActionConstants").PLATFORM_CONTEXT_ADDED:this.handlePlatformContextAdded(a);this.emit("change");break;case b("P2PActionConstants").PLATFORM_CONTEXT_ADDED_ERROR:this.handlePlatformContextAddedError(a);this.emit("change");break;case b("P2PActionConstants").PLATFORM_CONTEXT_SAVE_ERRORS_CLEARED:this.handlePlatformContextSaveErrorsCleared(a);this.emit("change");break;case b("P2PActionConstants").PLATFORM_CONTEXT_BANNER_DISMISSED:this.handlePlatformContextBannerDisimssed(a);this.emit("change");break;case b("P2PActionConstants").PLATFORM_CONTEXT_PRODUCT_ITEM_SOLD:this.handlePlatformContextProductItemSold(a);this.emit("change");break;case b("P2PActionConstants").PLATFORM_CONTEXT_CHANGED:this.handlePlatformContextChanged(a);this.emit("change");break}};a.prototype.handleChannelUpdated=function(a,c){a=c.obj;b("P2PActions").addPlatformContext(a)};a.prototype.handleChannelChanged=function(a,c){a=c.obj;b("P2PActions").platformContextChanged(a)};a.prototype.handlePlatformContextAdded=function(a){this.setPlatformContext(a)};a.prototype.handlePlatformContextAddedError=function(a){i.set(a.itemID,a.error)};a.prototype.handlePlatformContextSaveErrorsCleared=function(a){i["delete"](a)};a.prototype.handlePlatformContextChanged=function(a){h.forEach(function(b,c){b.id===a.id&&this.setPlatformContext(a)}.bind(this))};a.prototype.handlePlatformContextBannerDisimssed=function(a){h.forEach(function(c,d){c.id===a&&(this.isViewerSellerForPlatformContext(c)?c=b("ImmutableObject").set(c,{banner:b("ImmutableObject").set(c.banner,{shouldShowToSeller:!1})}):this.isViewerBuyerForPlatformContext(c)&&(c=b("ImmutableObject").set(c,{banner:b("ImmutableObject").set(c.banner,{shouldShowToBuyer:!1})})),h.set(d,c))}.bind(this))};a.prototype.handlePlatformContextProductItemSold=function(a){h.forEach(function(c,d){c.id===a&&(c=b("ImmutableObject").set(c,{product:b("ImmutableObject").set(c.product,{isAvailable:!1})}),h.set(d,c))})};a.prototype.setPlatformContext=function(a){var c=new(b("ImmutableObject"))(a);c=b("ImmutableObject").set(c,{product:new(b("ImmutableObject"))(a.product)});c=b("ImmutableObject").set(c,{banner:new(b("ImmutableObject"))(a.banner)});h.set(this.getOtherUserIDForPlatformContext(a),c)};a.prototype.shouldShowBanner=function(a){__p&&__p();var c;if(!a)return!1;c=this.getPlatformContextByOtherUserID(a);if(!c){h.set(a,new(b("ImmutableObject"))({}));b("P2PAPI").getPlatformContextByOtherUserID({otherUserID:a});return!1}a=c.banner;return!!(this.isViewerSellerForPlatformContext(c)&&a.shouldShowToSeller||this.isViewerBuyerForPlatformContext(c)&&a.shouldShowToBuyer)};a.prototype.isViewerSellerForPlatformContext=function(a){return a.sellerID===b("CurrentUser").getID()};a.prototype.isViewerBuyerForPlatformContext=function(a){return a.buyerID===b("CurrentUser").getID()};a.prototype.getOtherUserIDForPlatformContext=function(a){return this.isViewerSellerForPlatformContext(a)?a.buyerID:a.sellerID};a.prototype.getPlatformContextByOtherUserID=function(a){return h.get(a)};a.prototype.getPlatformContextByID=function(a){__p&&__p();for(var b=h.values(),c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;if(e.id===a)return e}return null};a.prototype.getThreadIDFromPlatformContext=function(a){a=this.getOtherUserIDForPlatformContext(a);return b("MercuryIDs").getThreadIDFromUserID(a)};a.prototype.getSaveError=function(a){return i.get(a)};a.prototype.getDispatchToken=function(){return j};e.exports=new a()}),null);
__d("XOfferController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/offer/detail/{offer_id}/",{offer_id:{type:"FBID",required:!0},referrer:{type:"Enum",enumType:1},__xts__:{type:"StringVector"},__tn__:{type:"String"}})}),null);